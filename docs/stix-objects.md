# Modelling CVEs as STIX Objects

For each CVE downloaded, 3 objects are created;

* Vulnerability SDO
* Indicator SDO
* Relationship SRO

Note, cve2stix relies on the following STIX Extensions from the [signalscorps/stix2-objects](https://github.com/signalscorps/stix2-objects) repository:

* NVD CVE Extension (for Vulnerability SDO)
* Vulnerability Pattern Extension (for Indicator SDO)

There are also enrichments that create other STIX Objects types (see: Enrichments).

## 1. Vulnerability SDOs

STIX 2.1 contains a Vulnerability SDO, [here is the specification for it](https://docs.oasis-open.org/cti/stix/v2.1/cs01/stix-v2.1-cs01.html#_q5ytzmajn6re).

Below you can see the fields from the CVE API Response that are mapped to the Vulnerability Object Properties;

```json
{
    "type": "vulnerability",
    "spec_version": "2.1",
    "id": "vulnerability--<GENERATED BY STIX2 LIBRARY>",
    "created": "<CVE_Items.publishedDate>",
    "created_by_ref": "<CVE2STIX IDENTITY OBJECT>",
    "modified": "<CVE_Items.lastModifiedDate>",
    "name": "<CVE_Items.cve.CVE_data_meta.ID>",
    "description": "<CVE_Items.cve.description.description_data.value>",
    "object_marking_refs": [
        "marking-definition--613f2e26-407d-48c7-9eca-b8e91df99dc9"
    ],
    "external_references": [
        {
            "source_name": "cve",
            "external_id": "<CVE_Items.cve.CVE_data_meta.ID>"
        },
        {
            "source_name": "cwe",
            "external_id": "<CVE_Items.cve.problemtype.problemtype_data.description.value[n]>"
        },
        { 
            "source_name": "<CVE_Items.cve.references.reference_data.name.[n]>",
            "url": "<CVE_Items.references.reference_data.url.[n]>",
        },
        {
            "source_name": "cve2stix",
            "description": "This object was created using cve2stix from the Signals Corps.",
            "url": "https://github.com/signalscorps/cve2stix"
        }
    ],
    "extensions": {
        "extension-definition--b2b5f2cd-49e6-4091-a0e0-c0bb71543e23": {
            "extension_type": "property-extension",
            "nvd_cve": {
                "PRINTED JSON CVE FIELDS"
            }
        }
    }
}
```

As an example using CVE-2022-33678;

```json
{
    "type": "vulnerability",
    "spec_version": "2.1",
    "id": "vulnerability--52b24543-6731-47f0-bbff-2a66d8423e9e",
    "created_by_ref": "identity--94a7d6da-daa5-491b-97f4-ce202459395e",
    "created": "2022-07-12T23:15Z",
    "modified": "2022-08-30T22:43Z",
    "name": "CVE-2022-33678",
    "description": "Azure Site Recovery Remote Code Execution Vulnerability. This CVE ID is unique from CVE-2022-33676.",
    "object_marking_refs": [
        "marking-definition--613f2e26-407d-48c7-9eca-b8e91df99dc9"
    ],
    "external_references": [
        {
            "source_name": "cve",
            "external_id": "CVE-2022-33678"
        },
        {
            "source_name": "cwe",
            "external_id": "NVD-CWE-noinfo"
        },
        { 
            "source_name": "https://portal.msrc.microsoft.com/en-US/security-guidance/advisory/CVE-2022-33678",
            "source": "MISC",
            "url": "https://portal.msrc.microsoft.com/en-US/security-guidance/advisory/CVE-2022-33678",
            "tags": [
              "Patch",
              "Vendor Advisory"
            ]
        },
        {
            "source_name": "cve2stix",
            "description": "This object was created using cve2stix from the Signals Corps.",
            "url": "https://github.com/signalscorps/cve2stix"
        }
    ],
    "extensions": {
        "extension-definition--b2b5f2cd-49e6-4091-a0e0-c0bb71543e23": {
            "extension_type": "property-extension",
			"nvd_cve": {
                "data_type": "CVE",
                "data_format": "MITRE",
                "data_version": "4.0",
                "CVE_data_meta": {
                    "ID": "CVE-2022-33678",
                    "ASSIGNER": "secure@microsoft.com"
                },
                "problemtype": {
                    "problemtype_data": [
                        {
                            "description": [
                                {
                                    "lang": "en",
                                    "value": "NVD-CWE-noinfo"
                                }
                            ]
                        }
                    ]
                },
                "references": {
                    "reference_data": [
                        {
                            "url": "https://portal.msrc.microsoft.com/en-US/security-guidance/advisory/CVE-2022-33678",
                            "name": "https://portal.msrc.microsoft.com/en-US/security-guidance/advisory/CVE-2022-33678",
                            "refsource": "MISC",
                            "tags": [
                                "Patch",
                                "Vendor Advisory"
                            ]
                        }
                    ]
                },
                "description": {
                    "description_data": [
                        {
                            "lang": "en",
                            "value": "Azure Site Recovery Remote Code Execution Vulnerability. This CVE ID is unique from CVE-2022-33676."
                        }
                    ]
                },
                "configurations": {
                    "CVE_data_version": "4.0",
                    "nodes": [
                        {
                            "operator": "OR",
                            "children": [],
                            "cpe_match": [
                                {
                                    "vulnerable": true,
                                    "cpe23Uri": "cpe:2.3:a:microsoft:azure_site_recovery:*:*:*:*:vmware_to_azure:*:*:*",
                                    "versionEndExcluding": "9.49.6395.1",
                                    "cpe_name": []
                                }
                            ]
                        }
                    ]
                },
                "impact": {
                    "baseMetricV3": {
                        "cvssV3": {
                            "version": "3.1",
                            "vectorString": "CVSS:3.1/AV:N/AC:L/PR:H/UI:N/S:U/C:H/I:H/A:H",
                            "attackVector": "NETWORK",
                            "attackComplexity": "LOW",
                            "privilegesRequired": "HIGH",
                            "userInteraction": "NONE",
                            "scope": "UNCHANGED",
                            "confidentialityImpact": "HIGH",
                            "integrityImpact": "HIGH",
                            "availabilityImpact": "HIGH",
                            "baseScore": 7.2,
                            "baseSeverity": "HIGH"
                        },
                        "exploitabilityScore": 1.2,
                        "impactScore": 5.9
                    },
                    "baseMetricV2": {
                        "cvssV2": {
                            "version": "2.0",
                            "vectorString": "AV:N/AC:L/Au:S/C:P/I:P/A:P",
                            "accessVector": "NETWORK",
                            "accessComplexity": "LOW",
                            "authentication": "SINGLE",
                            "confidentialityImpact": "PARTIAL",
                            "integrityImpact": "PARTIAL",
                            "availabilityImpact": "PARTIAL",
                            "baseScore": 6.5
                        },
                        "severity": "MEDIUM",
                        "exploitabilityScore": 8.0,
                        "impactScore": 6.4,
                        "acInsufInfo": false,
                        "obtainAllPrivilege": false,
                        "obtainUserPrivilege": false,
                        "obtainOtherPrivilege": false,
                        "userInteractionRequired": false
                    }
                },
                "publishedDate": "2022-07-12T23:15Z",
                "lastModifiedDate": "2022-08-30T22:43Z"
            }
        }
    }
}
```

## 2. Indicator SDO

The `configurations` section in the CVE API response is the critical part of the CVE for matching to a users software.

These `configurations` are indicators of potential malicious activities. Whilst we include the raw CPE `configurations` data in the Vulnerability Object, to better represent this data cve2stix also uses the [STIX 2.1 Indicator SDO](https://docs.oasis-open.org/cti/stix/v2.1/csprd01/stix-v2.1-csprd01.html#_Toc16070633).

STIX 2.1 Indicator Objects contain [STIX Patterns](/blog/2022/oasis-stix-2_1-103-patterns) that can be used to describe the CPE configuration logic defined in the CVE.

The STIX 2.1 Specification contains a Software SCO (CPEs) that can be used to construct these patterns, [here is the specification for it](https://docs.oasis-open.org/cti/stix/v2.1/csprd01/stix-v2.1-csprd01.html#_Toc16070740).

One Indicator Object exists for a CVE.

The actual node CPE data is captured in the `cpe_match.cpe23Uri` under either `nodes.cpe_match` or `nodes.children.cpe_match`. Each of these has its `operator` value. Both pieces of data determine how the STIX Pattern is written inside the Indicator SDO.

All `children` patterns and wrapped in parenthesis. Operators define how multiple `cpe23Uri`s are considered.

The general structure of the indicator object takes the form;

```json
{
    "type": "indicator",
    "spec_version": "2.1",
    "id": "indicator--<GENERATED BY STIX2 LIBRARY>",
    "created": "<CVE_Items.publishedDate>",
    "created_by_ref": "identity--<IDENTITY ID>",
    "modified": "<CVE_Items.lastModifiedDate>",
    "indicator_types": [
        "compromised"
    ],
    "name": "<CVE_Items.cve.CVE_data_meta.ID>",
    "description": "<CVE_Items.cve.description.description_data.value>",
    "pattern": "[<CPE MATCH PATTERN>]",
    "pattern_type": "stix",
    "valid_from": "<CVE_Items.publishedDate>",
    "external_references": [
        {
            "source_name": "cve2stix",
            "description": "This object was created using cve2stix from the Signals Corps.",
            "url": "https://github.com/signalscorps/cve2stix"
        }
    ],
    "extensions": {
        "extension-definition--b463c449-d022-48b7-b464-3e9c7ec5cf16": {
            "extension_type": "property-extension",
            "all_cpe23uris": [
                "<ALL CPES IN PATTERN>"
            ],
            "vulnerable_cpe23uris": [
                "<VULNERABLE CPES IN PATTERN>"
            ]
        }
    }
}
```

Each object in the pattern is also reprensted by a CPE. So CPEURIs that match CPEs created by cve2stix are listed under the `object_refs` property.

To populate the properties `<CPE MATCH PATTERN>` and `<VULNERABLE CPES IN PATTERN>` let me demonstrate with some examples.

### 2.1. Simple Relationships

[CVE-2022-29098 offers a good example of simple relationships](https://nvd.nist.gov/vuln/detail/CVE-2022-29098). 

```json
"nodes": [
    {
        "operator": "OR",
        "children": [],
        "cpe_match": [
            {
                "vulnerable": true,
                "cpe23Uri": "cpe:2.3:a:dell:powerscale_onefs:9.0.0:*:*:*:*:*:*:*",
                "cpe_name": [
                    {
                        "cpe23Uri": "cpe:2.3:a:dell:powerscale_onefs:9.0.0:*:*:*:*:*:*:*",
                        "lastModifiedDate": "2022-06-27T18:02Z"
                    }
                ]
            },
            {
                "vulnerable": true,
                "cpe23Uri": "cpe:2.3:a:dell:powerscale_onefs:9.1.0:*:*:*:*:*:*:*",
                "cpe_name": [
                    {
                        "cpe23Uri": "cpe:2.3:a:dell:powerscale_onefs:9.1.0:*:*:*:*:*:*:*",
                        "lastModifiedDate": "2022-06-27T18:02Z"
                    }
                ]
            },
            {
                "vulnerable": true,
                "cpe23Uri": "cpe:2.3:a:dell:powerscale_onefs:9.3.0:*:*:*:*:*:*:*",
                "cpe_name": [
                    {
                        "cpe23Uri": "cpe:2.3:a:dell:powerscale_onefs:9.3.0:*:*:*:*:*:*:*",
                        "lastModifiedDate": "2022-06-27T18:02Z"
                    }
                ]
            },
            {
                "vulnerable": true,
                "cpe23Uri": "cpe:2.3:a:dell:powerscale_onefs:9.2.1:*:*:*:*:*:*:*",
                "cpe_name": [
                    {
                        "cpe23Uri": "cpe:2.3:a:dell:powerscale_onefs:9.2.1:*:*:*:*:*:*:*",
                        "lastModifiedDate": "2022-06-27T18:02Z"
                    }
                ]
            },
            {
                "vulnerable": true,
                "cpe23Uri": "cpe:2.3:a:dell:powerscale_onefs:9.2.0:*:*:*:*:*:*:*",
                "cpe_name": [
                    {
                        "cpe23Uri": "cpe:2.3:a:dell:powerscale_onefs:9.2.0:*:*:*:*:*:*:*",
                        "lastModifiedDate": "2022-06-27T18:02Z"
                    }
                ]
            },
            {
                "vulnerable": true,
                "cpe23Uri": "cpe:2.3:a:dell:powerscale_onefs:9.1.1:*:*:*:*:*:*:*",
                "cpe_name": [
                    {
                        "cpe23Uri": "cpe:2.3:a:dell:powerscale_onefs:9.1.1:*:*:*:*:*:*:*",
                        "lastModifiedDate": "2022-06-27T18:02Z"
                    }
                ]
            }
        ]
    }
]
```

Note the top operator is `OR` and there are 5 `cpe_match` nodes inside it. All `cpe23Uri` are `"vulnerable": true`. There are no `children`.

Therefore the STIX `pattern` takes the structure;

```
[ (software.cpe='nodes.cpe_match[0].cpe23Uri' OR software.cpe='nodes.cpe_match[1].cpe23Uri' OR software.cpe='nodes.cpe_match[2].cpe23Uri' OR software.cpe='nodes.cpe_match[3].cpe23Uri' OR software.cpe='nodes.cpe_match[4].cpe23Uri') ]
```

Which printed inside the full indicator using the fields from the CVE gives;

```json
{
    "type": "indicator",
    "spec_version": "2.1",
    ...
    "pattern": "[software.cpe='cpe:2.3:a:dell:powerscale_onefs:9.0.0:*:*:*:*:*:*:*' OR software.cpe='cpe:2.3:a:dell:powerscale_onefs:9.1.0:*:*:*:*:*:*:*' OR software.cpe='cpe:2.3:a:dell:powerscale_onefs:9.1.1:*:*:*:*:*:*:*' OR software.cpe='cpe:2.3:a:dell:powerscale_onefs:9.2.0:*:*:*:*:*:*:*' OR software.cpe='cpe:2.3:a:dell:powerscale_onefs:9.2.1:*:*:*:*:*:*:*' OR software.cpe='cpe:2.3:a:dell:powerscale_onefs:9.3.0:*:*:*:*:*:*:*']",
    "pattern_type": "stix",
    "valid_from": "2022-06-01T15:15:00.000Z",
    "extensions": {
        "extension-definition--b463c449-d022-48b7-b464-3e9c7ec5cf16": {
            "extension_type": "property-extension",
            "all_cpe23uris": [
          	     "cpe:2.3:a:dell:powerscale_onefs:9.0.0:*:*:*:*:*:*:*",
          	     "cpe:2.3:a:dell:powerscale_onefs:9.1.0:*:*:*:*:*:*:*",
          	     "cpe:2.3:a:dell:powerscale_onefs:9.1.1:*:*:*:*:*:*:*",
          	     "cpe:2.3:a:dell:powerscale_onefs:9.2.0:*:*:*:*:*:*:*",
          	     "cpe:2.3:a:dell:powerscale_onefs:9.2.1:*:*:*:*:*:*:*",
          	     "cpe:2.3:a:dell:powerscale_onefs:9.3.0:*:*:*:*:*:*:*"
            ],
            "vulnerable_cpe23uris": [
                "cpe:2.3:a:dell:powerscale_onefs:9.0.0:*:*:*:*:*:*:*",
                "cpe:2.3:a:dell:powerscale_onefs:9.1.0:*:*:*:*:*:*:*",
                "cpe:2.3:a:dell:powerscale_onefs:9.1.1:*:*:*:*:*:*:*",
                "cpe:2.3:a:dell:powerscale_onefs:9.2.0:*:*:*:*:*:*:*",
                "cpe:2.3:a:dell:powerscale_onefs:9.2.1:*:*:*:*:*:*:*",
                "cpe:2.3:a:dell:powerscale_onefs:9.3.0:*:*:*:*:*:*:*"
            ]
        }
    }
}
```

### 2.2. Running On/With Relationships

[Let me demonstrate how more complex Relationships are modelled using the example CVE-2022-27948](https://nvd.nist.gov/vuln/detail/CVE-2022-27948). 

```json
"configurations": {
    "CVE_data_version": "4.0",
    "nodes": [
        {
            "operator": "AND",
            "children": [
                {
                    "operator": "OR",
                    "children": [],
                    "cpe_match": [
                        {
                            "vulnerable": true,
                            "cpe23Uri": "cpe:2.3:o:tesla:model_s_firmware:*:*:*:*:*:*:*:*",
                            "versionEndIncluding": "2022-03-26",
                            "cpe_name": []
                        },
                        {
                            "vulnerable": true,
                            "cpe23Uri": "cpe:2.3:o:tesla:model_x_firmware:*:*:*:*:*:*:*:*",
                            "versionEndIncluding": "2022-03-26",
                            "cpe_name": [
                                {
                                    "cpe23Uri": "cpe:2.3:o:tesla:model_x_firmware:-:*:*:*:*:*:*:*",
                                    "lastModifiedDate": "2021-06-30T18:26Z"
                                },
                                {
                                    "cpe23Uri": "cpe:2.3:o:tesla:model_x_firmware:2020-11-23:*:*:*:*:*:*:*",
                                    "lastModifiedDate": "2021-06-30T18:26Z"
                                }
                            ]
                        },
                        {
                            "vulnerable": true,
                            "cpe23Uri": "cpe:2.3:o:tesla:model_3_firmware:*:*:*:*:*:*:*:*",
                            "versionEndIncluding": "2022-03-26",
                            "cpe_name": [
                                {
                                    "cpe23Uri": "cpe:2.3:o:tesla:model_3_firmware:-:*:*:*:*:*:*:*",
                                    "lastModifiedDate": "2020-08-26T22:42Z"
                                }
                            ]
                        }
                    ]
                },
                {
                    "operator": "OR",
                    "children": [],
                    "cpe_match": [
                        {
                            "vulnerable": false,
                            "cpe23Uri": "cpe:2.3:h:tesla:model_3:-:*:*:*:*:*:*:*",
                            "cpe_name": [
                                {
                                    "cpe23Uri": "cpe:2.3:h:tesla:model_3:-:*:*:*:*:*:*:*",
                                    "lastModifiedDate": "2020-08-26T22:42Z"
                                }
                            ]
                        },
                        {
                            "vulnerable": false,
                            "cpe23Uri": "cpe:2.3:h:tesla:model_x:-:*:*:*:*:*:*:*",
                            "cpe_name": [
                                {
                                    "cpe23Uri": "cpe:2.3:h:tesla:model_x:-:*:*:*:*:*:*:*",
                                    "lastModifiedDate": "2021-08-17T17:09Z"
                                }
                            ]
                        },
                        {
                            "vulnerable": false,
                            "cpe23Uri": "cpe:2.3:h:tesla:model_s:-:*:*:*:*:*:*:*",
                            "cpe_name": []
                        }
                    ]
                }
            ],
            "cpe_match": []
        }
    ]
}
```

Note the top operator is `AND` and the `children` operators are `OR`. In this case, we get a pattern like so;

```
[ ((software.cpe='nodes.children[0].cpe_match[0].cpe23Uri' OR software.cpe='nodes.children[0].cpe_match[1].cpe23Uri' OR software.cpe='nodes.children[0].cpe_match[2].cpe23Uri') AND (software.cpe='nodes.children[1].cpe_match[0].cpe23Uri' OR software.cpe='nodes.children[1].cpe_match[1].cpe23Uri' OR software.cpe='nodes.children[1].cpe_match[2].cpe23Uri')) ]
```
Note how the 2 children nodes get wrapped in parenthesis `()`.

Also note how in `software.cpe='nodes.children[1]` all `cpe23Uri`s are `"vulnerable": false` which gives an Indicator SDO with properties;

```json
{
    "type": "indicator",
    "spec_version": "2.1",
    ...
    "pattern": "[ (software.cpe='cpe:2.3:o:tesla:model_s_firmware:*:*:*:*:*:*:*:*' OR software.cpe='cpe:2.3:o:tesla:model_x_firmware:*:*:*:*:*:*:*:*' OR software.cpe='cpe:2.3:o:tesla:model_3_firmware:*:*:*:*:*:*:*:*') AND (software.cpe='cpe:2.3:h:tesla:model_3:-:*:*:*:*:*:*:*' OR software.cpe='cpe:2.3:h:tesla:model_x:-:*:*:*:*:*:*:*' OR software.cpe='cpe:2.3:h:tesla:model_s:-:*:*:*:*:*:*:*') ]",
    "pattern_type": "stix",
    "valid_from": "2022-06-01T15:15:00.000Z",
    "extensions": {
        "extension-definition--b463c449-d022-48b7-b464-3e9c7ec5cf16": {
            "extension_type": "property-extension",
            "all_cpe23uris": [
                "cpe:2.3:o:tesla:model_s_firmware:*:*:*:*:*:*:*:*",
                "cpe:2.3:o:tesla:model_x_firmware:*:*:*:*:*:*:*:*",
                "cpe:2.3:o:tesla:model_3_firmware:*:*:*:*:*:*:*:*",
                "software.cpe='cpe:2.3:h:tesla:model_3:-:*:*:*:*:*:*:*",
                "software.cpe='cpe:2.3:h:tesla:model_x:-:*:*:*:*:*:*:*",
                "software.cpe='cpe:2.3:h:tesla:model_s:-:*:*:*:*:*:*:*"  
            ],
            "vulnerable_cpe23uris": [
                "cpe:2.3:o:tesla:model_s_firmware:*:*:*:*:*:*:*:*",
                "cpe:2.3:o:tesla:model_x_firmware:*:*:*:*:*:*:*:*",
                "cpe:2.3:o:tesla:model_3_firmware:*:*:*:*:*:*:*:*"
            ]
        }
    }
}
```

### Advanced Relationships

I will use CVE-2019-18939 to demonstrate another more complex `configuration`: https://nvd.nist.gov/vuln/detail/CVE-2019-18939

```json
"configurations": {
    "CVE_data_version": "4.0",
        "nodes": [
            {
                "operator": "AND",
                "children": [],
                "cpe_match": [
                    {
                        "vulnerable": false,
                        "cpe23Uri": "cpe:2.3:h:eq-3:homematic_ccu2:-:*:*:*:*:*:*:*",
                        "cpe_name": [
                            {
                                "cpe23Uri": "cpe:2.3:h:eq-3:homematic_ccu2:-:*:*:*:*:*:*:*",
                                "lastModifiedDate": "2020-04-10T16:04Z"
                            }
                        ]
                    },
                    {
                        "vulnerable": true,
                        "cpe23Uri": "cpe:2.3:o:eq-3:homematic_ccu2_firmware:2.47.20:*:*:*:*:*:*:*",
                        "cpe_name": [
                            {
                                "cpe23Uri": "cpe:2.3:o:eq-3:homematic_ccu2_firmware:2.47.20:*:*:*:*:*:*:*",
                                "lastModifiedDate": "2020-04-10T19:19Z"
                                }
                        ]
                    },
                    {
                        "vulnerable": true,
                        "cpe23Uri": "cpe:2.3:a:hm-print_project:hm-print:1.2a:*:*:*:*:*:*:*",
                        "cpe_name": [
                            {
                                "cpe23Uri": "cpe:2.3:a:hm-print_project:hm-print:1.2a:*:*:*:*:*:*:*",
                                "lastModifiedDate": "2020-04-10T19:19Z"
                            }
                        ]
                    }
                ]
            },
            {
                "operator": "AND",
                "children": [],
                "cpe_match": [
                    {
                        "vulnerable": false,
                        "cpe23Uri": "cpe:2.3:h:eq-3:homematic_ccu3:-:*:*:*:*:*:*:*",
                        "cpe_name": [
                            {
                                "cpe23Uri": "cpe:2.3:h:eq-3:homematic_ccu3:-:*:*:*:*:*:*:*",
                                "lastModifiedDate": "2020-04-10T16:04Z"
                            }
                        ]
                    },
                    {
                        "vulnerable": true,
                        "cpe23Uri": "cpe:2.3:o:eq-3:homematic_ccu3_firmware:3.47.18:*:*:*:*:*:*:*",
                        "cpe_name": [
                            {
                                "cpe23Uri": "cpe:2.3:o:eq-3:homematic_ccu3_firmware:3.47.18:*:*:*:*:*:*:*",
                                "lastModifiedDate": "2020-04-10T19:31Z"
                            }
                        ]
                    },
                    {
                        "vulnerable": true,
                        "cpe23Uri": "cpe:2.3:a:hm-print_project:hm-print:1.2:*:*:*:*:*:*:*",
                        "cpe_name": [
                            {
                                "cpe23Uri": "cpe:2.3:a:hm-print_project:hm-print:1.2:*:*:*:*:*:*:*",
                                "lastModifiedDate": "2020-04-10T19:19Z"
                            }
                        ]
                    }
                ]
            },
            {
                "operator": "AND",
                "children": [],
                "cpe_match": [
                    {
                        "vulnerable": false,
                        "cpe23Uri": "cpe:2.3:h:eq-3:homematic_ccu3:-:*:*:*:*:*:*:*",
                        "cpe_name": [
                            {
                                "cpe23Uri": "cpe:2.3:h:eq-3:homematic_ccu3:-:*:*:*:*:*:*:*",
                                "lastModifiedDate": "2020-04-10T16:04Z"
                            }
                        ]
                    },
                    {
                        "vulnerable": true,
                        "cpe23Uri": "cpe:2.3:o:eq-3:homematic_ccu3_firmware:3.47.18:*:*:*:*:*:*:*",
                        "cpe_name": [
                            {
                                "cpe23Uri": "cpe:2.3:o:eq-3:homematic_ccu3_firmware:3.47.18:*:*:*:*:*:*:*",
                                "lastModifiedDate": "2020-04-10T19:31Z"
                            }
                        ]
                    },
                    {
                        "vulnerable": true,
                        "cpe23Uri": "cpe:2.3:a:hm-print_project:hm-print:1.2a:*:*:*:*:*:*:*",
                        "cpe_name": [
                            {
                                "cpe23Uri": "cpe:2.3:a:hm-print_project:hm-print:1.2a:*:*:*:*:*:*:*",
                                "lastModifiedDate": "2020-04-10T19:19Z"
                            }
                        ]
                    }
                ]
            },
            {
                "operator": "AND",
                "children": [],
                "cpe_match": [
                    {
                        "vulnerable": false,
                        "cpe23Uri": "cpe:2.3:h:eq-3:homematic_ccu2:-:*:*:*:*:*:*:*",
                        "cpe_name": [
                            {
                                "cpe23Uri": "cpe:2.3:h:eq-3:homematic_ccu2:-:*:*:*:*:*:*:*",
                                "lastModifiedDate": "2020-04-10T16:04Z"
                            }
                        ]
                    },
                    {
                        "vulnerable": true,
                        "cpe23Uri": "cpe:2.3:o:eq-3:homematic_ccu2_firmware:2.47.20:*:*:*:*:*:*:*",
                        "cpe_name": [
                            {
                                "cpe23Uri": "cpe:2.3:o:eq-3:homematic_ccu2_firmware:2.47.20:*:*:*:*:*:*:*",
                                "lastModifiedDate": "2020-04-10T19:19Z"
                            }
                        ]
                    },
                    {
                        "vulnerable": true,
                        "cpe23Uri": "cpe:2.3:a:hm-print_project:hm-print:1.2:*:*:*:*:*:*:*",
                        "cpe_name": [
                            {
                                "cpe23Uri": "cpe:2.3:a:hm-print_project:hm-print:1.2:*:*:*:*:*:*:*",
                                "lastModifiedDate": "2020-04-10T19:19Z"
                            }
                        ]
                    }
                ]
            }
        ]
    },
```

Note there are 4 top operators all with the `AND` operator and each with 1 `cpe_match` node inside them. Each CPE match are 3 `cpe23Uri`. Note, each `cpe_match` is implicitly joined by an `OR` statement. Which gives a pattern structure like so

```
[ ((software.cpe='nodes.cpe_match[0].cpe23Uri[0] AND software.cpe='nodes.cpe_match[0].cpe23Uri[1] AND software.cpe='nodes.cpe_match[0].cpe23Uri[2]) OR (software.cpe='nodes.cpe_match[1].cpe23Uri[0] AND software.cpe='nodes.cpe_match[1].cpe23Uri[1] AND software.cpe='nodes.cpe_match[1].cpe23Uri[2]) OR (software.cpe='nodes.cpe_match[2].cpe23Uri[0] AND software.cpe='nodes.cpe_match[2].cpe23Uri[1] AND software.cpe='nodes.cpe_match[2].cpe23Uri[2]) OR (software.cpe='nodes.cpe_match[3].cpe23Uri[0] AND software.cpe='nodes.cpe_match[3].cpe23Uri[1] AND software.cpe='nodes.cpe_match[3].cpe23Uri[2])) ]
```

Which give a Indicator Object

```json
{
    "type": "indicator",
    "spec_version": "2.1",
    ...
    "pattern": "[ ((software.cpe='cpe:2.3:h:eq-3:homematic_ccu2:-:*:*:*:*:*:*:*' AND software.cpe='cpe:2.3:o:eq-3:homematic_ccu2_firmware:2.47.20:*:*:*:*:*:*:*' AND software.cpe='cpe:2.3:a:hm-print_project:hm-print:1.2a:*:*:*:*:*:*:*') OR (software.cpe='cpe:2.3:h:eq-3:homematic_ccu3:-:*:*:*:*:*:*:*' AND software.cpe='cpe:2.3:o:eq-3:homematic_ccu3_firmware:3.47.18:*:*:*:*:*:*:*' AND software.cpe='cpe:2.3:a:hm-print_project:hm-print:1.2:*:*:*:*:*:*:*') OR (software.cpe='cpe:2.3:h:eq-3:homematic_ccu3:-:*:*:*:*:*:*:*' AND software.cpe='cpe:2.3:o:eq-3:homematic_ccu3_firmware:3.47.18:*:*:*:*:*:*:*' AND software.cpe='cpe:2.3:a:hm-print_project:hm-print:1.2a:*:*:*:*:*:*:*') OR (software.cpe='cpe:2.3:h:eq-3:homematic_ccu2:-:*:*:*:*:*:*:*' AND software.cpe='cpe:2.3:o:eq-3:homematic_ccu2_firmware:2.47.20:*:*:*:*:*:*:*' AND software.cpe='cpe:2.3:a:hm-print_project:hm-print:1.2:*:*:*:*:*:*:*')) ]",
    "pattern_type": "stix",
    "valid_from": "2022-06-01T15:15:00.000Z",
    "extensions": {
        "extension-definition--b463c449-d022-48b7-b464-3e9c7ec5cf16": {
            "extension_type": "property-extension",
            "all_cpe23uris": [
                "cpe:2.3:h:eq-3:homematic_ccu2:-:*:*:*:*:*:*:*",
                "cpe:2.3:o:eq-3:homematic_ccu2_firmware:2.47.20:*:*:*:*:*:*:*",
                "cpe:2.3:a:hm-print_project:hm-print:1.2a:*:*:*:*:*:*:*",
                "cpe:2.3:h:eq-3:homematic_ccu3:-:*:*:*:*:*:*:*",
                "cpe:2.3:o:eq-3:homematic_ccu3_firmware:3.47.18:*:*:*:*:*:*:*",
                "cpe:2.3:a:hm-print_project:hm-print:1.2:*:*:*:*:*:*:*",
                "cpe:2.3:h:eq-3:homematic_ccu3:-:*:*:*:*:*:*:*",
                "cpe:2.3:o:eq-3:homematic_ccu3_firmware:3.47.18:*:*:*:*:*:*:*",
                "cpe:2.3:a:hm-print_project:hm-print:1.2a:*:*:*:*:*:*:*",
                "cpe:2.3:h:eq-3:homematic_ccu2:-:*:*:*:*:*:*:*",
                "cpe:2.3:o:eq-3:homematic_ccu2_firmware:2.47.20:*:*:*:*:*:*:*",
                "cpe:2.3:a:hm-print_project:hm-print:1.2:*:*:*:*:*:*:*"
            ],
            "vulnerable_cpe23uris": [
                "cpe:2.3:o:eq-3:homematic_ccu2_firmware:2.47.20:*:*:*:*:*:*:*",
                "cpe:2.3:a:hm-print_project:hm-print:1.2a:*:*:*:*:*:*:*",
                "cpe:2.3:o:eq-3:homematic_ccu3_firmware:3.47.18:*:*:*:*:*:*:*",
                "cpe:2.3:a:hm-print_project:hm-print:1.2:*:*:*:*:*:*:*"
            ]
        }
    }
}
```

Note how some `cpeuri`s appear as vulnerable more than once, but only show once under the `vulnerable_cpeid` property.

### 3. Relationship SROs

Relationship SROs link Vulnerability SDOs to Indicator SDOs.

To create the Vulnerability to Indicator Relationship the following Relationship Object is used;

```json
{
    "type": "relationship",
    "spec_version": "2.1",
    "id": "relationship--<GENERATED BY STIX2 LIBRARY>",
    "created": "<publishedDate of cve>",
    "created_by_ref": "<CVE2STIX IDENTITY OBJECT>",
    "modified": "<publishedDate of cve>",
    "relationship_type": "identifies",
    "source_ref": "indicator--<Indicator STIX Object>",
    "target_ref": "vulnerability--<Vulnerability STIX Object>",
    "external_references": [
        {
            "source_name": "cve2stix",
            "description": "This object was created using cve2stix from the Signals Corps.",
            "url": "https://github.com/signalscorps/cve2stix"
        }
    ]
}
```

### 4. Dealing with updates

As noted in the previous sections (see: NVD API), CVEs are update periodically to update, change, or even revoke information in a CVE.

cve2stix looks for updates to CVEs every 24 hours. When an update is seen, so are the Indicator and Vulnerability Objects.

When the update happens, the appropriate fields are updated as per the mapping above and a new version of the same STIX object is created (`id` property remains the same). Each version of these objects is stored in the filesystem (see: backends).