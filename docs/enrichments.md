# Enrichments

cve2stix adds MITRE ATT&CK (Enterprise, Mobile, and ICS) and MITRE CAPEC knowledge as STIX Objects to CVEs.

## CWEs

CVEs can contain references to zero or more [Common Weakness Enumerations (CWE's)](https://cwe.mitre.org/) referenced inside the `cve.problemtype` Object.

CWE's are a community-developed list of software and hardware weakness types managed MITRE. It serves as a common language as a baseline for weakness identification, mitigation, and prevention efforts.

For example, [CWE-79: Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting')](https://cwe.mitre.org/data/definitions/79.html).

When a CWE is linked to a CVE it is describing how the weakness (aka vulnerability) is being exploited in a standardised way.

Here is another example; [CWE-20 (Improper Input Validation)](https://cwe.mitre.org/data/definitions/20.html) reported in CVE-2022-33704: https://nvd.nist.gov/vuln/detail/CVE-2022-33704

In the CVE you can identify the CWE under the `problemtype` object;

```json
"problemtype": {
    "problemtype_data": [
        {
            "description": [
                {
                    "lang": "en",
                    "value": "CWE-20"
                }
            ]
        }
    ]
},
```

You will see the CVE response does not provide any detail about the CWE, except for its ID (in this case, CWE-20).

## CAPECs

[Common Attack Pattern Enumerations and Classifications (CAPEC)](https://capec.mitre.org/index.html) provides comprehensive dictionary of known patterns of attack employed by adversaries to exploit known weaknesses (CWE's) in cyber-enabled capabilities.

Like CWEs, CAPECs are also managed by MITRE.

For example, [CAPEC-148: Content Spoofing](https://capec.mitre.org/data/definitions/148.html).

> An adversary modifies content to make it contain something other than what the original content producer intended while keeping the apparent source of the content unchanged.

Whilst CVEs do not explicitly reference CAPECs, CAPECs can be joined to CWE IDs inside CVEs.

MITRE maintain CAPECs as [STIX 2.1 Attack Pattern Objects](https://github.com/mitre/cti/blob/master/capec/).

[CAPEC 2.1 uses a range of STIX 2.1 Objects](https://github.com/mitre/cti/tree/master/capec/2.1), but the Attack Pattern Object is the one representing the CAPEC. e.g. [CAPEC 112](https://github.com/mitre/cti/blob/master/capec/2.1/attack-pattern/attack-pattern--7b423196-9de6-400f-91de-a1f26b3f19f1.json).

The CWE inside the Vulnerability Object is matched to the CAPEC Attack Pattern objects `external_references.external_id property`.

For example, using the earlier example of CWE-20 inside a Vulnerability, it would match to [CAPEC-73](https://github.com/mitre/cti/blob/master/capec/2.1/attack-pattern/attack-pattern--f156c3d0-eeb3-4e12-b075-8995c009de55.json), [CAPEC-473](https://github.com/mitre/cti/blob/master/capec/2.1/attack-pattern/attack-pattern--d94762c1-3c78-47eb-8212-e0c770ba43a9.json), etc.

In the case of a match, no new Attack Pattern object is actually created. A new Relationship Object is created between the created STIX Vulnerability Object with imported CAPEC STIX Object. The CAPEC STIX Object is saved, but remains unmodified.

When these matches are found, CAPECs are linked to Vulnerability records using the following relationship object structure;

```json
{
  "type": "relationship",
  "spec_version": "2.1",
  "id": "relationship--<GENERATED BY STIX2 LIBRARY>",
  "created_by_ref": "identity--<IDENTITY ID>",
  "created": "<CVE_Items.publishedDate>",
  "modified": "<CVE_Items.lastModifiedDate>",
  "relationship_type": "targets",
  "source_ref": "attack-pattern--<ATTACK PATTERN FOR CAPEC>",
  "target_ref": "vulnerability--<CVE VULNERABILITY OBJECT>"
}
```

## ATT&CK Entries (Attack Pattern Objects)

ATT&CK is a globally-accessible knowledge-base of adversary tactics and techniques based on real-world observations.

ATT&CK is natively modelled as a wide range of STIX 2.1 Objects (including a few custom STIX Objects). If you missed it, [my ATT&CK tutorial series dives deep into the framework and the STIX Objects used](/blog/2022/mitre-attack-101-data-structure).

Mapping ATT&CK data to CVE's requires using CAPEC data as a key to create the relationship. CAPECs are referenced inside Attack Pattern Objects covering ATT&CK Technique and Sub-technique objects in the [Enterprise](https://github.com/mitre/cti/tree/master/enterprise-attack) and [Mobile](https://github.com/mitre/cti/tree/master/mobile-attack) and [ICS](https://github.com/mitre/cti/tree/master/ics-attack) matrices.

Take the ATT&CK sub-technique; T1110.004 Credential Stuffing ([attack-pattern--b2d03cea-aec1-45ca-9744-9ee583c1e1cc](https://github.com/mitre/cti/blob/master/enterprise-attack/attack-pattern/attack-pattern--b2d03cea-aec1-45ca-9744-9ee583c1e1cc.json)), which references CAPEC-600.

Therefore a join is made between CVEs linked to CAPEC ID (600) and the ATT&CK STIX 2.1 Attack Pattern Object. The relationship links the ATT&CK Object and Vulnerability (not ATT&CK to CAPEC)

```json
{
  "type": "relationship",
  "spec_version": "2.1",
  "id": "relationship--<GENERATED BY STIX2 LIBRARY>",
  "created_by_ref": "identity--<SIGNALS CORPS IDENTITY ID>",
  "created": "<CVE_Items.publishedDate>",
  "modified": "<CVE_Items.lastModifiedDate>",
  "relationship_type": "targets",
  "source_ref": "attack-pattern--<ATTACK PATTERN FOR ATT&CK STIX OBJECT>",
  "target_ref": "vulnerability--<CVE VULNERABILITY OBJECT>"
}
```
